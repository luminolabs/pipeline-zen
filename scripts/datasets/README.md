# Scripts for dataset manipulation

## `hf_download.py`

This script supports downloading Hugging Face Datasets
and saving them into JSON format based on parameters:
- `hfds`: Hugging Face Dataset Name.
- `dest`: Destination directory (local), where the dataset will be saved in one/more JSON files.

Note: Not tested exhaustively, but works for the following examples.

Example usage:

- https://huggingface.co/datasets/TIGER-Lab/MathInstruct
```
> python scripts/datasets/hf_download.py -hfds TIGER-Lab/MathInstruct -dest /tmp/math_instruct/
Saving dataset TIGER-Lab/MathInstruct to path: /tmp/math_instruct/dataset_part_0_of_1.json.  Details: Column names: ['source', 'output', 'instruction'], Rows: 262039
...
```
- https://huggingface.co/datasets/jtatman/python-code-dataset-500k
```
> python scripts/datasets/hf_download.py -hfds jtatman/python-code-dataset-500k -dest /tmp/python-code/
Saving dataset jtatman/python-code-dataset-500k to path: /tmp/python-code/dataset_part_0_of_1.json.  Details: Column names: ['output', 'instruction', 'system'], Rows: 559515
...
```

## `dataset_prep.py`

This script prepares the given dataset based on parameters:
- `dataset_dir` (`dsd`): Dir containing one/more JSON files
- `seed` (`s`): The RNG seed to use.
- `sample_percent` (`sp`): What percentage of the dataset to sample and use for training/testing cycles.  This will be capped to: `100 - holdout_percent`
- `holdout_percent` (`hp`): What percentage of the dataset to "holdout" for final validation (restricted to range, see code)
- `num_folds` (`k`): Number of folds for "k-fold" cross-validation (restricted to range, see code)

The directory layout of data generated by this script is described as follows:
```
{dsd}
├── dataset_seed_{seed}_sample_{sp}_holdout_{hp}_k_{k}
│   ├── holdout.json
│   ├── fold_0/
│   │   ├── train.json
│   │   ├── test.json
...
│   ├── fold_{k-1}/
│   │   ├── train.json
│   │   ├── test.json
```

Example usage:
```
> python scripts/datasets/dataset_prep.py -dsd /tmp/math_instruct -s 2957 -sp 20
Loaded data from /tmp/math_instruct: 262039 entries
Writing 52407 entries to file: /tmp/math_instruct/dataset_seed_2957_sample_20_holdout_20_k_4/holdout.json
Writing 39305 entries to file: /tmp/math_instruct/dataset_seed_2957_sample_20_holdout_20_k_4/fold_0/train.json
Writing 13102 entries to file: /tmp/math_instruct/dataset_seed_2957_sample_20_holdout_20_k_4/fold_0/test.json
Writing 39305 entries to file: /tmp/math_instruct/dataset_seed_2957_sample_20_holdout_20_k_4/fold_1/train.json
Writing 13102 entries to file: /tmp/math_instruct/dataset_seed_2957_sample_20_holdout_20_k_4/fold_1/test.json
Writing 39305 entries to file: /tmp/math_instruct/dataset_seed_2957_sample_20_holdout_20_k_4/fold_2/train.json
Writing 13102 entries to file: /tmp/math_instruct/dataset_seed_2957_sample_20_holdout_20_k_4/fold_2/test.json
Writing 39306 entries to file: /tmp/math_instruct/dataset_seed_2957_sample_20_holdout_20_k_4/fold_3/train.json
Writing 13101 entries to file: /tmp/math_instruct/dataset_seed_2957_sample_20_holdout_20_k_4/fold_3/test.json

> python scripts/datasets/dataset_prep.py -dsd /tmp/math_instruct -s 2957 -sp 50 
Loaded data from /tmp/math_instruct: 262039 entries
Writing 52407 entries to file: /tmp/math_instruct/dataset_seed_2957_sample_50_holdout_20_k_4/holdout.json
Writing 98264 entries to file: /tmp/math_instruct/dataset_seed_2957_sample_50_holdout_20_k_4/fold_0/train.json
Writing 32755 entries to file: /tmp/math_instruct/dataset_seed_2957_sample_50_holdout_20_k_4/fold_0/test.json
Writing 98264 entries to file: /tmp/math_instruct/dataset_seed_2957_sample_50_holdout_20_k_4/fold_1/train.json
Writing 32755 entries to file: /tmp/math_instruct/dataset_seed_2957_sample_50_holdout_20_k_4/fold_1/test.json
Writing 98264 entries to file: /tmp/math_instruct/dataset_seed_2957_sample_50_holdout_20_k_4/fold_2/train.json
Writing 32755 entries to file: /tmp/math_instruct/dataset_seed_2957_sample_50_holdout_20_k_4/fold_2/test.json
Writing 98265 entries to file: /tmp/math_instruct/dataset_seed_2957_sample_50_holdout_20_k_4/fold_3/train.json
Writing 32754 entries to file: /tmp/math_instruct/dataset_seed_2957_sample_50_holdout_20_k_4/fold_3/test.json

> python scripts/datasets/dataset_prep.py -dsd /tmp/math_instruct -s 2957 -sp 100
Loaded data from /tmp/math_instruct: 262039 entries
Writing 52407 entries to file: /tmp/math_instruct/dataset_seed_2957_sample_80_holdout_20_k_4/holdout.json
Writing 157223 entries to file: /tmp/math_instruct/dataset_seed_2957_sample_80_holdout_20_k_4/fold_0/train.json
Writing 52408 entries to file: /tmp/math_instruct/dataset_seed_2957_sample_80_holdout_20_k_4/fold_0/test.json
Writing 157223 entries to file: /tmp/math_instruct/dataset_seed_2957_sample_80_holdout_20_k_4/fold_1/train.json
Writing 52408 entries to file: /tmp/math_instruct/dataset_seed_2957_sample_80_holdout_20_k_4/fold_1/test.json
Writing 157223 entries to file: /tmp/math_instruct/dataset_seed_2957_sample_80_holdout_20_k_4/fold_2/train.json
Writing 52408 entries to file: /tmp/math_instruct/dataset_seed_2957_sample_80_holdout_20_k_4/fold_2/test.json
Writing 157224 entries to file: /tmp/math_instruct/dataset_seed_2957_sample_80_holdout_20_k_4/fold_3/train.json
Writing 52407 entries to file: /tmp/math_instruct/dataset_seed_2957_sample_80_holdout_20_k_4/fold_3/test.json

> python scripts/datasets/dataset_prep.py -dsd /tmp/python-code -s 2957 -sp 20  
Loaded data from /tmp/python-code: 559515 entries
Writing 111903 entries to file: /tmp/python-code/dataset_seed_2957_sample_20_holdout_20_k_4/holdout.json
Writing 83927 entries to file: /tmp/python-code/dataset_seed_2957_sample_20_holdout_20_k_4/fold_0/train.json
Writing 27976 entries to file: /tmp/python-code/dataset_seed_2957_sample_20_holdout_20_k_4/fold_0/test.json
Writing 83927 entries to file: /tmp/python-code/dataset_seed_2957_sample_20_holdout_20_k_4/fold_1/train.json
Writing 27976 entries to file: /tmp/python-code/dataset_seed_2957_sample_20_holdout_20_k_4/fold_1/test.json
Writing 83927 entries to file: /tmp/python-code/dataset_seed_2957_sample_20_holdout_20_k_4/fold_2/train.json
Writing 27976 entries to file: /tmp/python-code/dataset_seed_2957_sample_20_holdout_20_k_4/fold_2/test.json
Writing 83928 entries to file: /tmp/python-code/dataset_seed_2957_sample_20_holdout_20_k_4/fold_3/train.json
Writing 27975 entries to file: /tmp/python-code/dataset_seed_2957_sample_20_holdout_20_k_4/fold_3/test.json

> python scripts/datasets/dataset_prep.py -dsd /tmp/python-code -s 2957 -sp 50
Loaded data from /tmp/python-code: 559515 entries
Writing 111903 entries to file: /tmp/python-code/dataset_seed_2957_sample_50_holdout_20_k_4/holdout.json
Writing 209817 entries to file: /tmp/python-code/dataset_seed_2957_sample_50_holdout_20_k_4/fold_0/train.json
Writing 69940 entries to file: /tmp/python-code/dataset_seed_2957_sample_50_holdout_20_k_4/fold_0/test.json
Writing 209818 entries to file: /tmp/python-code/dataset_seed_2957_sample_50_holdout_20_k_4/fold_1/train.json
Writing 69939 entries to file: /tmp/python-code/dataset_seed_2957_sample_50_holdout_20_k_4/fold_1/test.json
Writing 209818 entries to file: /tmp/python-code/dataset_seed_2957_sample_50_holdout_20_k_4/fold_2/train.json
Writing 69939 entries to file: /tmp/python-code/dataset_seed_2957_sample_50_holdout_20_k_4/fold_2/test.json
Writing 209818 entries to file: /tmp/python-code/dataset_seed_2957_sample_50_holdout_20_k_4/fold_3/train.json
Writing 69939 entries to file: /tmp/python-code/dataset_seed_2957_sample_50_holdout_20_k_4/fold_3/test.json

> python scripts/datasets/dataset_prep.py -dsd /tmp/python-code -s 2957 -sp 100
Loaded data from /tmp/python-code: 559515 entries
Writing 111903 entries to file: /tmp/python-code/dataset_seed_2957_sample_80_holdout_20_k_4/holdout.json
Writing 335709 entries to file: /tmp/python-code/dataset_seed_2957_sample_80_holdout_20_k_4/fold_0/train.json
Writing 111903 entries to file: /tmp/python-code/dataset_seed_2957_sample_80_holdout_20_k_4/fold_0/test.json
Writing 335709 entries to file: /tmp/python-code/dataset_seed_2957_sample_80_holdout_20_k_4/fold_1/train.json
Writing 111903 entries to file: /tmp/python-code/dataset_seed_2957_sample_80_holdout_20_k_4/fold_1/test.json
Writing 335709 entries to file: /tmp/python-code/dataset_seed_2957_sample_80_holdout_20_k_4/fold_2/train.json
Writing 111903 entries to file: /tmp/python-code/dataset_seed_2957_sample_80_holdout_20_k_4/fold_2/test.json
Writing 335709 entries to file: /tmp/python-code/dataset_seed_2957_sample_80_holdout_20_k_4/fold_3/train.json
Writing 111903 entries to file: /tmp/python-code/dataset_seed_2957_sample_80_holdout_20_k_4/fold_3/test.json
```
